<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈõªÊ∞ó„Ç±„Éº„Éñ„É´Áô∫Ê≥®„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .balance {
            font-size: 1.5rem;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 50px;
            display: inline-block;
            margin-top: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .products-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }

        .orders-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }

        .section-title {
            font-size: 1.8rem;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .product-info {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 15px;
        }

        .product-details h3 {
            color: #2c3e50;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .product-details .price {
            color: #e74c3c;
            font-size: 1.4rem;
            font-weight: bold;
        }

        .product-details .delivery-time {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .order-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .order-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #2980b9, #3498db);
            transform: scale(1.05);
        }

        .order-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .order-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-title {
            color: #2c3e50;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-pending {
            background: #f39c12;
            color: white;
        }

        .status-delivered {
            background: #27ae60;
            color: white;
        }

        .status-cancelled {
            background: #e74c3c;
            color: white;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 10px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 1s ease;
            border-radius: 4px;
        }

        .no-orders {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.1rem;
            padding: 40px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .delivery-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1000;
            min-width: 300px;
        }

        .delivery-notification.show {
            transform: translateX(0);
        }

        .delivery-notification h4 {
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .cancel-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .cancel-btn:hover {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
            transform: scale(1.05);
        }

        .cancel-info {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .balance {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° ÈõªÊ∞ó„Ç±„Éº„Éñ„É´Áô∫Ê≥®„Ç∑„Çπ„ÉÜ„É†</h1>
            <div class="balance">üí∞ ÊÆãÈ´ò: ¬•<span id="balance">100,000</span></div>
        </div>

        <div class="main-content">
            <div class="products-section">
                <h2 class="section-title">üì¶ ÂïÜÂìÅ‰∏ÄË¶ß</h2>
                
                <div class="product-card">
                    <div class="product-info">
                        <div class="product-details">
                            <h3>ÈõªÊ∞ó„Ç±„Éº„Éñ„É´ 1m</h3>
                            <div class="price">¬•10,000</div>
                            <div class="delivery-time">üìÖ Á¥çÊúü: 10ÂàÜ</div>
                        </div>
                        <button class="order-btn" onclick="orderProduct(1, 10000, 10)">Áô∫Ê≥®</button>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-info">
                        <div class="product-details">
                            <h3>ÈõªÊ∞ó„Ç±„Éº„Éñ„É´ 2m</h3>
                            <div class="price">¬•15,000</div>
                            <div class="delivery-time">üìÖ Á¥çÊúü: 15ÂàÜ</div>
                        </div>
                        <button class="order-btn" onclick="orderProduct(2, 15000, 15)">Áô∫Ê≥®</button>
                    </div>
                </div>

                <div class="product-card">
                    <div class="product-info">
                        <div class="product-details">
                            <h3>ÈõªÊ∞ó„Ç±„Éº„Éñ„É´ 3m</h3>
                            <div class="price">¬•18,000</div>
                            <div class="delivery-time">üìÖ Á¥çÊúü: 20ÂàÜ</div>
                        </div>
                        <button class="order-btn" onclick="orderProduct(3, 18000, 20)">Áô∫Ê≥®</button>
                    </div>
                </div>
            </div>

            <div class="orders-section">
                <h2 class="section-title">üöõ Áô∫Ê≥®Áä∂Ê≥Å</h2>
                <div id="orders-container">
                    <div class="no-orders">„Åæ„Å†Áô∫Ê≥®„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                </div>
            </div>
        </div>
    </div>

    <div id="delivery-notification" class="delivery-notification">
        <h4>üì¶ Á¥çÂìÅÂÆå‰∫ÜÔºÅ</h4>
        <p id="delivery-message"></p>
    </div>

    <script>
        let balance = 100000;
        let orders = [];
        let orderCounter = 0;

        function updateBalance() {
            document.getElementById('balance').textContent = balance.toLocaleString();
            
            // „Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ„ÇíÊõ¥Êñ∞
            const orderButtons = document.querySelectorAll('.order-btn');
            const prices = [10000, 15000, 18000];
            
            orderButtons.forEach((btn, index) => {
                btn.disabled = balance < prices[index];
            });
        }

        function orderProduct(length, price, deliveryMinutes) {
            if (balance < price) {
                alert('ÊÆãÈ´ò„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ');
                return;
            }

            balance -= price;
            orderCounter++;
            
            const orderTime = new Date();
            const deliveryTime = new Date(orderTime.getTime() + deliveryMinutes * 60000);
            
            const order = {
                id: orderCounter,
                length: length,
                price: price,
                orderTime: orderTime,
                deliveryTime: deliveryTime,
                deliveryMinutes: deliveryMinutes,
                delivered: false,
                cancelled: false
            };
            
            orders.push(order);
            updateBalance();
            updateOrdersDisplay();
            
            // Á¥çÂìÅ„Çø„Ç§„Éû„Éº„ÇíË®≠ÂÆö
            setTimeout(() => {
                deliverOrder(order.id);
            }, deliveryMinutes * 60000);
        }

        function deliverOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order && !order.delivered && !order.cancelled) {
                order.delivered = true;
                updateOrdersDisplay();
                showDeliveryNotification(order);
            }
        }

        function cancelOrder(orderId) {
            console.log('cancelOrder called with ID:', orderId);
            const order = orders.find(o => o.id === orderId);
            console.log('Found order:', order);
            
            if (!order) {
                console.log('Order not found');
                return;
            }
            
            if (order.delivered) {
                console.log('Order already delivered');
                return;
            }
            
            if (order.cancelled) {
                console.log('Order already cancelled');
                return;
            }

            const cancellationFee = Math.floor(order.price / 2);
            const refund = order.price - cancellationFee;
            
            console.log('Cancellation fee:', cancellationFee, 'Refund:', refund);
            
            const userConfirmed = confirm(`„Ç≠„É£„É≥„Çª„É´ÊâãÊï∞Êñô„Å®„Åó„Å¶¬•${cancellationFee.toLocaleString()}„Åå„Åã„Åã„Çä„Åæ„Åô„ÄÇ¬•${refund.toLocaleString()}„ÅåËøîÈáë„Åï„Çå„Åæ„Åô„ÄÇ\n\n„Ç≠„É£„É≥„Çª„É´„Åó„Åæ„Åô„ÅãÔºü`);
            console.log('User confirmed:', userConfirmed);
            
            if (userConfirmed) {
                console.log('Processing cancellation...');
                order.cancelled = true;
                balance += refund;
                console.log('Order cancelled, new balance:', balance);
                updateBalance();
                updateOrdersDisplay();
                showCancellationNotification(order, refund, cancellationFee);
            } else {
                console.log('User cancelled the cancellation');
            }
        }

        function showCancellationNotification(order, refund, fee) {
            const notification = document.getElementById('delivery-notification');
            const message = document.getElementById('delivery-message');
            
            notification.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            message.innerHTML = `Ê≥®Êñá #${order.id} „Çí„Ç≠„É£„É≥„Çª„É´„Åó„Åæ„Åó„Åü<br>ËøîÈáëÈ°ç: ¬•${refund.toLocaleString()} (ÊâãÊï∞Êñô: ¬•${fee.toLocaleString()})`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
                // ÈÄöÁü•„ÅÆËÉåÊôØËâ≤„ÇíÂÖÉ„Å´Êàª„Åô
                setTimeout(() => {
                    notification.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                }, 500);
            }, 4000);
        }

        function showDeliveryNotification(order) {
            const notification = document.getElementById('delivery-notification');
            const message = document.getElementById('delivery-message');
            
            message.textContent = `ÈõªÊ∞ó„Ç±„Éº„Éñ„É´ ${order.length}m „ÅåÁ¥çÂìÅ„Åï„Çå„Åæ„Åó„ÅüÔºÅ`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        function updateOrdersDisplay() {
            const container = document.getElementById('orders-container');
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="no-orders">„Åæ„Å†Áô∫Ê≥®„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            const sortedOrders = [...orders].sort((a, b) => {
                // „Ç≠„É£„É≥„Çª„É´Ê∏à„Åø„ÄÅÈÖçÈÄÅ‰∏≠„ÄÅÁ¥çÂìÅÂÆå‰∫Ü„ÅÆÈ†Ü„Åß„ÇΩ„Éº„Éà
                const getStatusPriority = (order) => {
                    if (order.cancelled) return 2;
                    if (order.delivered) return 1;
                    return 0; // ÈÖçÈÄÅ‰∏≠
                };
                return getStatusPriority(a) - getStatusPriority(b) || b.orderTime - a.orderTime;
            });
            
            container.innerHTML = sortedOrders.map(order => {
                const now = new Date();
                const timeRemaining = Math.max(0, order.deliveryTime - now);
                const totalTime = order.deliveryMinutes * 60000;
                const elapsed = totalTime - timeRemaining;
                const progress = Math.min(100, (elapsed / totalTime) * 100);
                
                let statusClass, statusText, timerDisplay, actionButton = '';
                
                if (order.cancelled) {
                    statusClass = 'status-cancelled';
                    statusText = '‚ùå „Ç≠„É£„É≥„Çª„É´Ê∏à';
                    timerDisplay = '--:--';
                } else if (order.delivered) {
                    statusClass = 'status-delivered';
                    statusText = '‚úÖ Á¥çÂìÅÂÆå‰∫Ü';
                    timerDisplay = '00:00';
                } else {
                    statusClass = 'status-pending';
                    statusText = '‚è≥ ÈÖçÈÄÅ‰∏≠';
                    const minutes = Math.floor(timeRemaining / 60000);
                    const seconds = Math.floor((timeRemaining % 60000) / 1000);
                    timerDisplay = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // „Ç≠„É£„É≥„Çª„É´„Éú„Çø„É≥„ÇíËøΩÂä†
                    const cancellationFee = Math.floor(order.price / 2);
                    actionButton = `
                        <button class="cancel-btn" onclick="cancelOrder(${order.id})" type="button">
                            „Ç≠„É£„É≥„Çª„É´
                        </button>
                        <div class="cancel-info">
                            ‚ÄªÊâãÊï∞Êñô: ¬•${cancellationFee.toLocaleString()}
                        </div>
                    `;
                }
                
                return `
                    <div class="order-item">
                        <div class="order-header">
                            <div class="order-title">Ê≥®Êñá #${order.id} - ÈõªÊ∞ó„Ç±„Éº„Éñ„É´ ${order.length}m</div>
                            <div class="order-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="timer-display">${timerDisplay}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div style="font-size: 0.9rem; color: #7f8c8d; margin-top: 10px;">
                            Áô∫Ê≥®‰æ°Ê†º: ¬•${order.price.toLocaleString()} | 
                            Áô∫Ê≥®ÊôÇÂàª: ${order.orderTime.toLocaleString('ja-JP')}
                        </div>
                        ${actionButton}
                    </div>
                `;
            }).join('');
        }

        // 1Áßí„Åî„Å®„Å´„Çø„Ç§„Éû„Éº„ÇíÊõ¥Êñ∞
        setInterval(() => {
            if (orders.some(order => !order.delivered && !order.cancelled)) {
                updateOrdersDisplay();
            }
        }, 1000);

        // ÂàùÊúüÂåñ
        updateBalance();
    </script>
</body>
</html>
